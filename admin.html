<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BuzzKart Admin</title>
<link rel="stylesheet" href="style.css"/>
<style>.box{max-width:820px;margin:24px auto;padding:16px;border:1px solid #223046;border-radius:14px;background:#111827}
.row{display:grid;grid-template-columns:140px 1fr;gap:10px;margin:8px 0}
.row input,.row textarea,.row select{padding:8px 10px;border-radius:10px;border:1px solid #223046;background:#0c121a;color:#e9eef5}
.btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
pre{background:#0c121a;padding:10px;border-radius:10px;white-space:pre-wrap}</style>
</head><body>
<header class="top"><div class="brand"><img src="assets/logo_dark.png" alt="BuzzKart"/><h1>BuzzKart — Admin</h1></div></header>
<main class="box">
  <div id="login">
    <div class="row"><label>Password</label><input id="pw" type="password" placeholder="Enter admin password"/></div>
    <div class="btns"><button id="enter">Enter</button></div>
    <p id="msg"></p>
  </div>
  <div id="panel" style="display:none">
    <h2>Add a product</h2>
    <div class="row"><label>URL</label><input id="url" placeholder="Temu/AliExpress/Amazon link"/></div>
    <div class="row"><label>Title</label><input id="title"/></div>
    <div class="row"><label>Description</label><textarea id="desc" rows="3"></textarea></div>
    <div class="row"><label>Price USD</label><input id="price" type="number" step="0.01"/></div>
    <div class="row"><label>Source</label><select id="source"><option>temu</option><option>aliexpress</option><option>amazon</option><option>pod</option></select></div>
    <div class="row"><label>Categories</label><input id="cats" placeholder="Home,Decor,Gadgets"/></div>
    <div class="row"><label>Image</label><input id="image" placeholder="assets/your.jpg"/></div>
    <div class="row"><label>Video</label><input id="video" placeholder="https://...mp4 (optional)"/></div>
    <h3>Affiliate IDs</h3>
    <div class="row"><label>Temu ID</label><input id="temuId" placeholder="YOUR_TEMU_ID"/></div>
    <div class="row"><label>Amazon tag</label><input id="amzTag" placeholder="yourtag-20"/></div>
    <div class="btns"><button id="gen">Generate files</button></div>
    <p>JSON to paste into <code>products.json</code>:</p>
    <pre id="out"></pre>
  </div>
</main>
<script>
async function getCfg(){try{const r=await fetch('config.json');return await r.json()}catch(e){return {admin_password:''}}}
function slug(s){return s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'')}
document.getElementById('enter').onclick=async()=>{
  const cfg=await getCfg(); const ok = (document.getElementById('pw').value===cfg.admin_password);
  document.getElementById('msg').textContent = ok?'':'Wrong password'; 
  document.getElementById('login').style.display = ok?'none':'block';
  document.getElementById('panel').style.display = ok?'block':'none';
};
document.getElementById('gen').onclick=()=>{
  const url=urlInput.value.trim(); const title=titleInput.value.trim(); const description=descInput.value.trim();
  const price=parseFloat(priceInput.value||'0'); const source=sourceInput.value;
  const cats=catsInput.value.split(',').map(s=>s.trim()).filter(Boolean); const image=imageInput.value.trim(); const video=videoInput.value.trim();
  if(!url||!title||!price){alert('Need URL, Title, Price');return;}
  const id = slug(source+'-'+title);
  const obj = {id,title,description,type:(source==='amazon'?'affiliate':(source==='pod'?'pod':'dropship')),source,categories:cats,price_usd:price,image,video,url,added_at:Math.floor(Date.now()/1000)};
  document.getElementById('out').textContent = JSON.stringify(obj,null,2);
  const red = `<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Redirecting…</title>
<script>
const cfg={{amazon_tag:'${document.getElementById('amzTag').value}',temu_affiliate_id:'${document.getElementById('temuId').value}',utm_source:'buzzkart'}};
const url={url_json};
function apply(u){{try{{const x=new URL(u);
 if(x.hostname.includes('amazon.')&&cfg.amazon_tag&&!x.searchParams.get('tag'))x.searchParams.set('tag',cfg.amazon_tag);
 if(x.hostname.includes('temu.')&&cfg.temu_affiliate_id&&!x.searchParams.get('affiliateId'))x.searchParams.set('affiliateId',cfg.temu_affiliate_id);
 if(cfg.utm_source&&!x.searchParams.get('utm_source'))x.searchParams.set('utm_source',cfg.utm_source);
 return x.toString();}}catch(e){{return u;}}}}
location.replace(apply(url));
</script></head><body>Redirecting…</body></html>`.replace('{url_json}', JSON.stringify(url));
  const blob=new Blob([red],{type:'text/html'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='p/'+id+'.html';a.click();
};
const urlInput=document.getElementById('url'),titleInput=document.getElementById('title'),descInput=document.getElementById('desc'),priceInput=document.getElementById('price'),sourceInput=document.getElementById('source'),catsInput=document.getElementById('cats'),imageInput=document.getElementById('image'),videoInput=document.getElementById('video');
</script>
</body></html>
